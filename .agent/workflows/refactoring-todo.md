# 重構待辦項目清單

**更新時間**: 2026-01-14 20:14  
**總項目數**: 18 項  
**已完成**: 4 項 (22%)  
**部分完成**: 3 項  
**未開始**: 11 項

---

## ✅ 已完成項目 (4/18)

### 1. ✅ 項目 3: 修復 Socket.IO CDN 依賴
- **狀態**: 完成
- **工時**: 2 小時
- **完成日期**: 2026-01-14

### 2. ✅ 項目 6: 提取配置常數
- **狀態**: 完成
- **工時**: 2.5 小時
- **完成日期**: 2026-01-14

### 3. ✅ 項目 14: 加密 LocalStorage 資料
- **狀態**: 完成
- **工時**: 20 分鐘
- **完成日期**: 2026-01-14

### 4. ✅ 項目 8 (部分): 創建 Logger 工具
- **狀態**: 工具已完成
- **工時**: 20 分鐘
- **待完成**: 替換 117 處 console.log

---

## 🔄 部分完成項目 (3/18)

### 5. 🔄 項目 1: 拆分 App.tsx (50% 完成)
**已投入**: 1.5 小時  
**剩餘**: 6-10 小時

**已完成**:
- ✅ useRoomStats Hook (100% - 已整合)
- ✅ useReplay Hook (已創建)
- ✅ useGameActions Hook (已創建)

**待完成**:
- [ ] 整合 useReplay Hook (20-30 分鐘)
- [ ] 整合 useGameActions Hook (15-20 分鐘)
- [ ] 創建 useSocketEvents Hook (2-3 小時)
- [ ] 創建 useConnection Hook (1 小時)
- [ ] 創建 useDialogs Hook (30-40 分鐘)
- [ ] 創建 Context (2-3 小時)
- [ ] 拆分組件 (2-3 小時)

---

### 6. 🔄 項目 8: 移除生產環境 Console.log (30% 完成)
**已投入**: 20 分鐘  
**剩餘**: 2.5-3.5 小時

**已完成**:
- ✅ Logger 工具已創建

**待完成**:
- [ ] 替換客戶端 console.log (68 處)
- [ ] 替換服務端 console.log (49 處)
- [ ] 測試

---

### 7. 🔄 項目 13: 優化 Strict Mode (50% 完成)
**已投入**: 15 分鐘  
**剩餘**: 5-10 分鐘

**已完成**:
- ✅ useEffectOnce Hook 已創建

**待完成**:
- [ ] 在 App.tsx 替換 hasInitialized ref (3 處)
- [ ] 測試

---

## ⏳ 未開始項目 (11/18)

### 🔴 高優先級 (P0) - 1 項

#### 項目 2: 統一狀態管理邏輯
**預估工時**: 4-6 小時  
**依賴**: 項目 1

**任務**:
- [ ] 在各個 Hook 中使用 reducer
- [ ] 統一狀態更新 actions
- [ ] 實現狀態持久化機制

**備註**: gameReducer.ts 已創建

---

### 🟡 中優先級 (P1) - 3 項

#### 項目 4: 重構 Socket 事件監聽器
**預估工時**: 6-8 小時

**任務**:
- [ ] 創建 useSocketEvents Hook
- [ ] 實現自動清理機制
- [ ] 統一事件處理邏輯

---

#### 項目 5: 統一類型定義
**預估工時**: 4-6 小時

**任務**:
- [ ] 創建共享類型套件
- [ ] 統一 client 和 server 的類型定義
- [ ] 消除重複定義

**問題**: client/src/types.ts 和 server/src/types.ts 有大量重複

---

#### 項目 7: 統一錯誤處理機制
**預估工時**: 4-5 小時

**任務**:
- [ ] 創建自定義錯誤類別
- [ ] 實現全局錯誤處理器
- [ ] 統一錯誤訊息格式

---

#### 項目 11: 添加單元測試
**預估工時**: 12-16 小時

**任務**:
- [ ] 設置 Vitest + React Testing Library
- [ ] 為核心邏輯添加測試
- [ ] 為 Hook 添加測試
- [ ] 為組件添加測試

**優先級建議**: 應提升優先級

---

### 🟢 低優先級 (P2) - 7 項

#### 項目 9: 重構 CSS 樣式
**預估工時**: 6-8 小時

**任務**:
- [ ] 提取常用樣式為組件
- [ ] 考慮使用 CSS Modules 或 styled-components

---

#### 項目 10: Server 端國際化
**預估工時**: 3-4 小時

**任務**:
- [ ] 整合 i18next
- [ ] 支援多語言錯誤訊息

---

#### 項目 12: 共享遊戲邏輯
**預估工時**: 4-6 小時

**任務**:
- [ ] 移動 gameLogic.ts 到共享套件
- [ ] 確保邏輯一致性

**問題**: gameLogic.ts 在 client 和 server 都有

---

#### 項目 15: 啟用 TypeScript 嚴格模式
**預估工時**: 4-6 小時

**任務**:
- [ ] 啟用 strict: true
- [ ] 修復所有類型錯誤

---

#### 項目 16: React 性能優化
**預估工時**: 4-6 小時

**任務**:
- [ ] 使用 React.memo
- [ ] 使用 useMemo 和 useCallback
- [ ] 使用 React Profiler 分析

---

#### 項目 17: 棋盤渲染優化
**預估工時**: 4-5 小時

**任務**:
- [ ] 只更新變化的格子
- [ ] 考慮使用 Canvas 渲染

**問題**: 每次更新重繪整個棋盤 (225 個格子)

---

#### 項目 18: 加強安全性
**預估工時**: 4-6 小時

**任務**:
- [ ] 限制 CORS origin
- [ ] 使用 Zod 驗證輸入
- [ ] 添加速率限制

---

## 📊 統計總覽

### 完成度
| 狀態 | 數量 | 百分比 |
|------|------|--------|
| ✅ 完成 | 4 | 22% |
| 🔄 部分完成 | 3 | 17% |
| ⏳ 未開始 | 11 | 61% |

### 工時統計
| 項目 | 已投入 | 剩餘預估 |
|------|--------|----------|
| 已完成 | 5.5h | 0h |
| 部分完成 | 2h | 9-14h |
| 未開始 | 0h | 63-91h |
| **總計** | **7.5h** | **72-105h** |

### 優先級分布
| 優先級 | 總數 | 已完成 | 部分完成 | 未開始 |
|--------|------|--------|----------|--------|
| 🔴 P0 | 3 | 1 | 2 | 0 |
| 🟡 P1 | 4 | 0 | 0 | 4 |
| 🟢 P2 | 11 | 3 | 1 | 7 |

---

## 🎯 建議的執行順序

### 短期 (本週)
1. **完成項目 13** (5-10 分鐘) - 最簡單
2. **完成項目 1 的 Hook 整合** (40-50 分鐘)
3. **開始項目 2** (4-6 小時)

### 中期 (2-3 週)
4. **項目 4**: 重構 Socket 事件 (6-8h)
5. **項目 5**: 統一類型定義 (4-6h)
6. **項目 11**: 添加單元測試 (12-16h)

### 長期 (1-2 月)
7. 完成項目 1 (組件拆分)
8. 項目 7: 統一錯誤處理
9. 其他優化項目

---

## 💡 快速勝利項目 (Quick Wins)

如果時間有限，優先完成這些：

1. **項目 13** (5-10 分鐘) ⭐⭐⭐
   - 只需替換 3 處代碼
   - Hook 已創建
   - 立即可完成

2. **項目 1 Hook 整合** (40-50 分鐘) ⭐⭐
   - Hook 已創建
   - 有詳細指南
   - 可以手動完成

3. **項目 10** (3-4 小時) ⭐
   - 獨立功能
   - 不影響其他部分

---

## 🔥 高影響項目

這些項目完成後影響最大：

1. **項目 1**: 拆分 App.tsx
   - 大幅提升可維護性
   - 減少 App.tsx 從 930 行到 ~200 行

2. **項目 11**: 添加單元測試
   - 保證重構質量
   - 減少回歸風險

3. **項目 5**: 統一類型定義
   - 消除重複
   - 提升類型安全

---

## 📝 今日成就 (2026-01-14)

### 完成的工作
1. ✅ 項目 3 (2h)
2. ✅ 項目 6 (2.5h)
3. ✅ 項目 14 (20分鐘)
4. 🔄 項目 1 - 創建 3 個 Hook (1.5h)
5. 🔄 項目 8 - 創建 Logger (20分鐘)
6. 🔄 項目 13 - 創建 useEffectOnce (15分鐘)

### 總工時
**7.5 小時**

### 代碼變更
- **新增文件**: 10 個
- **Git 提交**: 8 個 (全部已推送)

---

## 🎯 下一次工作建議

### 如果有 30 分鐘
- 完成項目 13 (5-10 分鐘)
- 開始項目 1 Hook 整合

### 如果有 2 小時
- 完成項目 13
- 完成項目 1 Hook 整合
- 開始其他 Hook

### 如果有 4+ 小時
- 完成上述所有
- 開始項目 2 或項目 4

---

**創建時間**: 2026-01-14 20:14  
**狀態**: 進度良好，繼續推進  
**完成度**: 22% (4/18 項目)
