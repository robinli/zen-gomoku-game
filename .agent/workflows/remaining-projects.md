# 未完成的重構項目清單

**更新時間**: 2026-01-14 14:00  
**已完成**: 3.5 / 18 項目 (19%)  
**剩餘工時**: 73-105 小時

---

## ✅ 已完成項目 (3.5/18)

1. ✅ **項目 3**: 修復 Socket.IO CDN 依賴 (2h)
2. ✅ **項目 6**: 提取配置常數 (2.5h)
3. 🔄 **項目 1**: 拆分 App.tsx (40% 完成)
   - ✅ useRoomStats Hook (完成)
   - ✅ useReplay Hook (已創建，待整合)
   - ⏳ useSocketEvents Hook (未開始)
   - ⏳ 其他 Hook 和組件 (未開始)

---

## 🔴 高優先級 (P0) - 剩餘 2.5 項

### 🔄 項目 1: 拆分 App.tsx (剩餘 60%)
**狀態**: 進行中  
**剩餘工時**: 6-10 小時

**待完成**:
- [ ] 完成 useReplay Hook 整合 (30-40 分鐘)
- [ ] 創建 useSocketEvents Hook (2-3 小時)
- [ ] 創建 useGameState Hook (1-2 小時)
- [ ] 創建 Context (GameContext, SocketContext) (2-3 小時)
- [ ] 拆分組件 (GameContainer, GameHeader, DialogManager) (2-3 小時)

**目標**: App.tsx 從 980 行縮減至 200 行以內

---

### ⏳ 項目 2: 統一狀態管理邏輯
**狀態**: 計劃中 (已創建 gameReducer.ts)  
**預估工時**: 4-6 小時

**任務**:
- [ ] 在各個 Hook 中使用 reducer
- [ ] 統一狀態更新 actions
- [ ] 實現狀態持久化機制

**備註**: 建議在完成項目 1 後執行

---

## 🟡 中優先級 (P1) - 4 項

### ⏳ 項目 4: 重構 Socket 事件監聽器
**預估工時**: 6-8 小時

**問題**:
- Socket 事件監聽器散落在 App.tsx 中
- 沒有統一的清理機制，可能造成記憶體洩漏

**方案**:
- [ ] 創建 useSocketEvents Hook
- [ ] 實現自動清理機制
- [ ] 統一事件處理邏輯

---

### ⏳ 項目 5: 統一類型定義
**預估工時**: 4-6 小時

**問題**:
- `client/src/types.ts` 和 `server/src/types.ts` 有重複定義
- 類型不一致可能導致錯誤

**方案**:
- [ ] 創建 `@zen-gomoku/shared-types` 套件
- [ ] 或使用 monorepo 工具 (如 Turborepo)
- [ ] 統一所有類型定義

---

### ⏳ 項目 7: 統一錯誤處理機制
**預估工時**: 4-5 小時

**問題**:
- 錯誤處理邏輯分散
- 缺少統一的錯誤類型

**方案**:
- [ ] 創建自定義錯誤類別
- [ ] 實現全局錯誤處理器
- [ ] 統一錯誤訊息格式

---

### ⏳ 項目 11: 添加單元測試
**預估工時**: 12-16 小時

**問題**:
- 缺少測試，重構風險高

**方案**:
- [ ] 設置 Vitest + React Testing Library
- [ ] 為核心邏輯添加測試
- [ ] 為 Hook 添加測試
- [ ] 為組件添加測試

---

## 🟢 低優先級 (P2) - 10 項

### ⏳ 項目 8: 移除生產環境 Console.log
**預估工時**: 3-4 小時

**方案**:
- [ ] 創建 logger 工具
- [ ] 根據環境變數控制日誌級別
- [ ] 替換所有 console.log

---

### ⏳ 項目 9: 重構 CSS 樣式
**預估工時**: 6-8 小時

**問題**:
- 過度依賴內聯 Tailwind CSS
- 樣式難以重用

**方案**:
- [ ] 提取常用樣式為組件
- [ ] 考慮使用 CSS Modules 或 styled-components

---

### ⏳ 項目 10: Server 端國際化
**預估工時**: 3-4 小時

**問題**:
- Server 錯誤訊息硬編碼為中文

**方案**:
- [ ] 整合 i18next
- [ ] 支援多語言錯誤訊息

---

### ⏳ 項目 12: 共享遊戲邏輯
**預估工時**: 4-6 小時

**問題**:
- `gameLogic.ts` 在 client 和 server 都有

**方案**:
- [ ] 移動到共享套件
- [ ] 確保邏輯一致性

---

### ⏳ 項目 13: 優化 React Strict Mode 相容性
**預估工時**: 2-3 小時

**問題**:
- 使用 `hasInitialized.current` 繞過 Strict Mode

**方案**:
- [ ] 使用 `useEffectOnce` 或狀態管理方案
- [ ] 移除 workaround

---

### ⏳ 項目 14: 加密 LocalStorage 資料
**預估工時**: 2-3 小時

**問題**:
- 敏感資料未加密

**方案**:
- [ ] 使用 crypto-js 加密
- [ ] 或改用 sessionStorage

---

### ⏳ 項目 15: 啟用 TypeScript 嚴格模式
**預估工時**: 4-6 小時

**方案**:
- [ ] 啟用 `strict: true`
- [ ] 修復所有類型錯誤

---

### ⏳ 項目 16: React 性能優化
**預估工時**: 4-6 小時

**方案**:
- [ ] 使用 React.memo
- [ ] 使用 useMemo 和 useCallback
- [ ] 使用 React Profiler 分析

---

### ⏳ 項目 17: 棋盤渲染優化
**預估工時**: 4-5 小時

**問題**:
- 每次更新重繪整個棋盤 (225 個格子)

**方案**:
- [ ] 只更新變化的格子
- [ ] 考慮使用 Canvas 渲染

---

### ⏳ 項目 18: 加強安全性
**預估工時**: 4-6 小時

**問題**:
- CORS 設定過於寬鬆
- 缺少輸入驗證

**方案**:
- [ ] 限制 CORS origin
- [ ] 使用 Zod 驗證輸入
- [ ] 添加速率限制

---

## 📊 總體統計

| 優先級 | 總數 | 已完成 | 進行中 | 未開始 | 剩餘工時 |
|--------|------|--------|--------|--------|----------|
| 🔴 P0 | 3 | 1 | 1 | 0.5 | 10-16h |
| 🟡 P1 | 4 | 0 | 0 | 4 | 26-35h |
| 🟢 P2 | 11 | 1 | 0 | 10 | 37-54h |
| **總計** | **18** | **2** | **1** | **14.5** | **73-105h** |

---

## 🎯 建議執行順序

### 短期 (1-2 週)
1. 🔄 完成項目 1 (useReplay 整合 + 其他 Hook)
2. ⏳ 項目 2 (統一狀態管理)
3. ⏳ 項目 4 (重構 Socket 事件)

### 中期 (3-4 週)
4. ⏳ 項目 5 (統一類型定義)
5. ⏳ 項目 7 (統一錯誤處理)
6. ⏳ 項目 11 (添加單元測試)

### 長期 (5-8 週)
7. ⏳ 項目 8-18 (優化和加固)

---

## 💡 快速勝利項目 (Quick Wins)

如果時間有限，建議優先完成這些項目：

1. **項目 1 (useReplay 整合)** - 30-40 分鐘 ⭐
2. **項目 8 (移除 Console.log)** - 3-4 小時
3. **項目 13 (優化 Strict Mode)** - 2-3 小時
4. **項目 14 (加密 LocalStorage)** - 2-3 小時

這些項目工時短、風險低、效果明顯。

---

## 📝 備註

- 所有工時為預估值，實際可能有 ±20% 的偏差
- 建議每完成一個項目立即測試並提交
- 高風險項目建議使用 Git 分支
- 可以根據實際情況調整優先級

---

**維護者**: Robin Li  
**最後更新**: 2026-01-14 14:00
