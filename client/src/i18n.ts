import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// Import translation files
// (We will move these to separate JSON files later if they get too big)
const resources = {
  en: {
    translation: {
      app: {
        title: "Zen Gomoku",
        subtitle: "Room {{roomId}}",
        turn: "{{color}}'s Turn",
        black: "Black",
        white: "White",
        winner: "Winner",
        loser: "Loser",
        draw: "Draw",
        ended: "Ended",
        yourTurn: "Your Turn",
        opponentTurn: "Opponent's Turn",
        reconnecting: "Reconnecting...",
        connected: "Connected",
        waiting: "Waiting...",
        online_game: "Online Game",
        network_recovering: "Recovering network...",
        client_server_version: "Client-Server Version",
        connection_failed: "Connection Failed",
        back_to_lobby: "Back to Lobby",
        finding_room: "Finding game room...",
        room_created: "Room Created: {{roomId}}",
        share_link: "Share Link: {{url}}",
        game_settings: "Game Settings: {{settings}}",
        joined_room: "Joined Room: {{roomId}} | You are: {{side}}",
        connection_lost_refresh: "Connection lost, please refresh the page",
        undo_success: "Undo successful",
        undo_rejected: "Undo request rejected",
        undo_rejected_message: "Opponent rejected your undo request",
        reset_success: "Reset successful",
        reset_rejected: "Reset request rejected",
        reset_rejected_message: "Opponent rejected your reset request",
        opponent_joined: "Opponent joined the room!",
        opponent_left: "Opponent left the room",
        error_prefix: "Server Error: ",
        clearing_error: "Clearing error state and returning to lobby",
        internet_unstable: "Internet unstable, trying to reconnect...",
        footer_text: "Zen Gomoku • Meet friends through chess",
        confirm_leave_title: "Leave Game?",
        confirm_leave_message: "Game is in progress. Leaving will interrupt the game and notify your opponent.",
        confirm_leave_confirm: "Leave",
        confirm_leave_cancel: "Cancel",
        opponent_left_title: "Opponent Left",
        opponent_left_message: "Opponent has left the room. The game has ended.",
        close: "Close",
        message_dialog_title: "Message",
        undo_limit_reached: "Undo limit reached ({{used}}/{{limit}})",
        undo_not_allowed: "Undo not allowed in this room",
        no_undo_steps: "No moves to undo",
        only_undo_own: "Can only undo your own last move",
        cannot_undo_title: "Cannot Undo",
        cannot_undo_not_allowed: "This room does not allow undo",
        cannot_undo_limit: "Undo limit reached ({{used}}/{{limit}})",
        cannot_undo_no_steps: "No steps to undo",
        cannot_undo_only_own: "You can only undo your own last move",
        room_id: "Room {{id}}"
      },
      lobby: {
        title: "Zen Gomoku",
        description: "Create a game room, choose your side, and invite friends to play.",
        choose_side: "CHOOSE YOUR SIDE",
        black_side: "Black (First)",
        white_side: "White (Second)",
        create_room: "Create Game Room",
        instructions_badge: "INSTRUCTIONS",
        instructions_text: "If you have a link shared by a friend,\nclick that link directly to join the game.",
        undo_rules: "Undo Rules",
        undo_limit_desc: "Undos allowed per player (requires opponent approval)",
        undo_options: {
          not_allowed: "Not Allowed",
          unlimited: "Unlimited",
          times: "{{count}} Time",
          times_plural: "{{count}} Times",
          times_recommended: "{{count}} Times (Recommended)"
        }
      },
      game_info: {
        invite_friend: "INVITE FRIEND",
        invite_text_share: "Click the button below to share the link with a friend and start playing.",
        invite_text_copy: "Please send this link to a friend. They can click it to start playing.",
        share_success: "Shared Successfully",
        share_link: "Share Invitation Link",
        copied: "Link Copied",
        or_copy: "Or Copy Link",
        copy_link: "Copy Share Link",
        share_hint: "Use the 'Share' button to keep the connection alive",
        waiting_response: "Waiting for response...",
        request_undo: "Request Undo",
        replay_game: "Replay Game",
        play_again: "Play Again",
        restart_game: "Restart Game",
        back_to_lobby: "Back to Lobby",
        identity: "Your Identity: {{identity}}",
        identity_black: "Black (First)",
        identity_white: "White (Second)",
        black_player: "Black",
        white_player: "White",
        you: "(You)",
        vs: "vs"
      },
      replay: {
        title: "Game Replay",
        step_progress: "Step {{current}} of {{total}}",
        restart: "Restart",
        prev: "Previous",
        play: "Play",
        pause: "Pause",
        next: "Next",
        end: "End",
        playing: "Auto playing...",
        controls_hint: "Use controls to review the game"
      },
      dialog: {
        undo_request_title: "Undo Request",
        undo_request_content: "{{player}} requests an undo",
        undo_request_sub: "Agree to undo the last move?",
        reset_request_title: "Restart Request",
        reset_request_content: "{{player}} requests to restart",
        reset_request_sub: "Agree to clear the board and restart?",
        reject: "Reject",
        agree: "Agree",
        confirm: "Confirm",
        cancel: "Cancel"
      },
      board: {
        view_results: "View Results",
        thinking: "OPPONENT THINKING",
        winner_black: "Black Wins",
        winner_white: "White Wins",
        draw: "Draw",
        game_over: "GAME OVER",
        view_board: "View Board"
      },
      message: {
          share_title: "Zen Gomoku",
          share_text: "Come play Gomoku with me!",
          share_error: "Share failed:",
          copy_prompt: "Please copy this link:",
          server_error: "Server Error: {{message}}",
          time_clearing: "Clearing error state and returning to lobby",
          undo_success_alert: "Undo successful",
          undo_rejected_title: "Undo Rejected",
          undo_rejected_msg: "Opponent rejected your undo request",
          reset_rejected_title: "Restart Rejected",
          reset_rejected_msg: "Opponent rejected your restart request",
          opponent_left_log: "Opponent has left the room",
          opponent_joined_log: "Opponent joined the room! Updating room state {{room}}",
          room_reconnected: "Room reconnected successfully",
          room_reconnect_failed: "Room reconnect failed, might be expired",
          socket_connected: "Socket connected",
          socket_error: "Socket connection error:",
          detect_room_id: "Detected Room ID, trying to join: {{roomId}}",
          socket_init_skip: "Socket already initialized, skipping",
          socket_init_start: "Initializing Socket connection...",
          detect_unfinished: "Detected unfinished room, trying to reconnect: {{roomId}}",
          game_end_update: "Detected game end - Preparing to update stats:",
          reset_clear_winner: "Reset game - Clearing winner record",
          undo_req_log: "Received undo request: {{requestedBy}}",
          undo_accepted_log: "Undo accepted: {{data}}",
          undo_rejected_log: "Undo rejected",
          reset_req_log: "Received reset request: {{requestedBy}}",
          reset_accepted_log: "Reset accepted",
          reset_rejected_log: "Reset rejected",
          create_room_log: "Room created: {{roomId}}",
          join_room_log: "Joined room: {{roomId}} | You are: {{side}}",
          request_undo_log: "Requesting undo",
          respond_undo_log: "Responding to undo request: {{accept}}",
          request_reset_log: "Requesting restart",
          respond_reset_log: "Responding to reset request: {{accept}}"
      }
    }
  },
  zh: {
    translation: {
      app: {
        title: "靜弈五子棋",
        subtitle: "房間 {{roomId}}",
        turn: "{{color}}回合",
        black: "黑方",
        white: "白方",
        winner: "勝者",
        loser: "敗者",
        draw: "平局",
        ended: "已結束",
        yourTurn: "您的",
        opponentTurn: "對手",
        reconnecting: "重連中",
        connected: "已連線",
        waiting: "等待中",
        online_game: "即時對戰中",
        network_recovering: "網路恢復中...",
        client_server_version: "Client-Server 連線版本",
        connection_failed: "連線失敗",
        back_to_lobby: "返回大廳",
        finding_room: "正在尋找遊戲房間中...",
        room_created: "房間已創建: {{roomId}}",
        share_link: "分享連結: {{url}}",
        game_settings: "遊戲設定: {{settings}}",
        joined_room: "已加入房間: {{roomId}} | 您執: {{side}}",
        connection_lost_refresh: "連線中斷，請重新整理頁面",
        undo_success: "悔棋成功",
        undo_rejected: "悔棋被拒絕",
        undo_rejected_message: "對方拒絕了您的悔棋請求",
        reset_success: "重置成功",
        reset_rejected: "重新開始被拒絕",
        reset_rejected_message: "對方拒絕了您的重新開始請求",
        opponent_joined: "對手已加入房間！",
        opponent_left: "對手已離開房間",
        error_prefix: "Server 錯誤: ",
        clearing_error: "清除錯誤狀態並返回大廳",
        internet_unstable: "網路不穩定，嘗試恢復連線中...",
        footer_text: "靜弈 • 以棋會友",
        confirm_leave_title: "確認離開遊戲？",
        confirm_leave_message: "遊戲正在進行中，離開後對局將中斷，對手將收到您離線的通知。",
        confirm_leave_confirm: "確認離開",
        confirm_leave_cancel: "取消",
        opponent_left_title: "對手已離開",
        opponent_left_message: "對方玩家已離開房間，對局已結束",
        close: "關閉",
        message_dialog_title: "訊息",
        undo_limit_reached: "悔棋次數已用完（{{used}}/{{limit}}）",
        undo_not_allowed: "此房間不允許悔棋",
        no_undo_steps: "沒有可以悔棋的步驟",
        only_undo_own: "只能悔自己剛下的棋",
        cannot_undo_title: "無法悔棋",
        cannot_undo_not_allowed: "此房間不允許悔棋",
        cannot_undo_limit: "悔棋次數已用完（{{used}}/{{limit}}）",
        cannot_undo_no_steps: "沒有可以悔棋的步驟",
        cannot_undo_only_own: "只能悔自己剛下的棋",
        room_id: "房間 {{id}}"
      },
      lobby: {
        title: "靜弈五子棋",
        description: "建立遊戲房間，選擇您的棋子顏色，並邀請好友進行對弈。",
        choose_side: "選擇您的立場",
        black_side: "執黑 (先行)",
        white_side: "執白 (後行)",
        create_room: "創建遊戲房間",
        instructions_badge: "說明",
        instructions_text: "若您已有好友分享的連結，<br />直接點擊該連結即可加入遊戲。",
        undo_rules: "悔棋規則",
        undo_limit_desc: "每方可悔棋次數（需對方同意）",
        undo_options: {
          not_allowed: "不允許悔棋",
          unlimited: "無限制",
          times: "{{count}} 次",
          times_plural: "{{count}} 次",
          times_recommended: "{{count}} 次（推薦）"
        }
      },
      game_info: {
        invite_friend: "邀請好友",
        invite_text_share: "點擊下方按鈕分享連結給朋友，開始對弈。",
        invite_text_copy: "請將此連結傳送給朋友，他們點擊後即可開始對弈。",
        share_success: "分享成功",
        share_link: "分享邀請連結",
        copied: "已複製連結",
        or_copy: "或複製連結",
        copy_link: "複製分享連結",
        share_hint: "使用「分享」按鈕可保持連線不中斷",
        waiting_response: "等待對方回應...",
        request_undo: "請求悔棋",
        replay_game: "回放對局",
        play_again: "再來一局",
        restart_game: "重新開始對局",
        back_to_lobby: "返回大廳",
        identity: "您的身份: {{identity}}",
        identity_black: "執黑 (先行)",
        identity_white: "執白 (後行)",
        black_player: "黑方",
        white_player: "白方",
        you: "(您)",
        vs: "vs"
      },
      replay: {
        title: "對局回放",
        step_progress: "第 {{current}} 步 / 共 {{total}} 步",
        restart: "重新開始",
        prev: "上一步",
        play: "自動播放",
        pause: "暫停",
        next: "下一步",
        end: "快進到最後",
        playing: "自動播放中...",
        controls_hint: "使用控制按鈕回顧對局"
      },
      dialog: {
        undo_request_title: "悔棋請求",
        undo_request_content: "{{player}} 請求悔棋",
        undo_request_sub: "是否同意撤銷最後一步？",
        reset_request_title: "重新開始請求",
        reset_request_content: "{{player}} 請求重新開始對局",
        reset_request_sub: "是否同意清空棋盤，重新開始？",
        reject: "拒絕",
        agree: "同意",
        confirm: "確認",
        cancel: "取消"
      },
      board: {
        view_results: "查看結算",
        thinking: "對手思考中",
        winner_black: "黑子勝出",
        winner_white: "白子勝出",
        draw: "和局",
        game_over: "對局已結束",
        view_board: "檢視棋盤連線"
      },
      message: {
          share_title: "靜弈五子棋",
          share_text: "快來跟我下五子棋！",
          share_error: "分享失敗:",
          copy_prompt: "請複製此連結:",
          server_error: "Server 錯誤: {{message}}",
          time_clearing: "清除錯誤狀態並返回大廳",
          undo_success_alert: "悔棋成功",
          undo_rejected_title: "悔棋被拒絕",
          undo_rejected_msg: "對方拒絕了您的悔棋請求",
          reset_rejected_title: "重新開始被拒絕",
          reset_rejected_msg: "對方拒絕了您的重新開始請求",
          opponent_left_log: "對手已離開房間",
          opponent_joined_log: "對手已加入房間！更新房間狀態 {{room}}",
          room_reconnected: "房間重連成功",
          room_reconnect_failed: "房間重連失敗，可能已過期",
          socket_connected: "Socket 連線成功",
          socket_error: "Socket 連線錯誤:",
          detect_room_id: "偵測到房間 ID，嘗試加入: {{roomId}}",
          socket_init_skip: "Socket 已初始化，跳過",
          socket_init_start: "正在初始化 Socket 連線...",
          detect_unfinished: "偵測到未完成的房間，嘗試重連: {{roomId}}",
          game_end_update: "檢測到遊戲結束 - 準備更新統計:",
          reset_clear_winner: "重置遊戲 - 清除勝者記錄",
          undo_req_log: "收到悔棋請求: {{requestedBy}}",
          undo_accepted_log: "悔棋成功: {{data}}",
          undo_rejected_log: "悔棋被拒絕",
          reset_req_log: "收到重置請求: {{requestedBy}}",
          reset_accepted_log: "重置成功",
          reset_rejected_log: "重置被拒絕",
          create_room_log: "房間已創建: {{roomId}}",
          join_room_log: "已加入房間: {{roomId}} | 您執: {{side}}",
          request_undo_log: "請求悔棋",
          respond_undo_log: "回應悔棋請求: {{accept}}",
          request_reset_log: "請求重新開始",
          respond_reset_log: "回應重置請求: {{accept}}"
      }
    }
  }
};

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'zh', // Default to Traditional Chinese if detection fails
    supportedLngs: ['en', 'zh', 'zh-TW', 'zh-CN'],

    // Map zh-TW and zh-CN to zh for now
    // In a real app we might want specific translations
    nonExplicitSupportedLngs: true,

    interpolation: {
      escapeValue: false // react already safes from xss
    },
    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
      lookupLocalStorage: 'i18nextLng',
    }
  });

export default i18n;
